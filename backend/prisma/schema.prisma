generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  HOMEOWNER
  CONTRACTOR
}

enum QuoteStatus {
  PENDING
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum MilestoneStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  DELAYED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  OVERDUE
}

model User {
  id        String              @id @default(cuid())
  email     String              @unique
  password  String
  name      String?
  role      Role                @default(HOMEOWNER)
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt

  // relations
  contractorProfile ContractorProfile?
  projects          Project[]           @relation("HomeownerProjects")
  refreshToken      RefreshToken[]
}

model ContractorProfile {
  id          String   @id @default(cuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String   @unique
  companyName String
  description String?
  services    String   // JSON string of services array
  logoUrl     String?
  verified    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // relations
  quotes      Quote[]
}

model Project {
  id          String   @id @default(cuid())
  homeowner   User     @relation("HomeownerProjects", fields: [homeownerId], references: [id])
  homeownerId String
  title       String
  description String?
  projectType String
  size        Float?   // mÂ²
  materials   String?  // materials preference
  budgetMin   Int?
  budgetMax   Int?
  predictedCost Int?   // from cost calculator
  status      String   @default("OPEN") // OPEN, IN_PROGRESS, COMPLETED, CANCELLED
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // relations
  quotes      Quote[]
  milestones  Milestone[]
}

model Quote {
  id             String      @id @default(cuid())
  project        Project     @relation(fields: [projectId], references: [id])
  projectId      String
  contractor     ContractorProfile @relation(fields: [contractorId], references: [id])
  contractorId   String
  
  totalAmount    Int         // total quote amount
  laborHours     Float?
  laborCost      Int?
  materialsCost  Int?
  extrasCost     Int?
  notes          String?
  
  status         QuoteStatus @default(PENDING)
  validUntil     DateTime?   // quote expiry
  
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  // relations
  lineItems      QuoteLineItem[]
  
  @@unique([projectId, contractorId]) // one quote per contractor per project
}

model QuoteLineItem {
  id          String @id @default(cuid())
  quote       Quote  @relation(fields: [quoteId], references: [id])
  quoteId     String
  
  category    String // "Labor", "Materials", "Equipment", etc.
  description String
  quantity    Float
  unitPrice   Int    // in cents
  totalPrice  Int    // quantity * unitPrice
  
  createdAt   DateTime @default(now())
}

model Milestone {
  id          String          @id @default(cuid())
  project     Project         @relation(fields: [projectId], references: [id])
  projectId   String
  
  title       String
  description String?
  order       Int             // milestone sequence
  status      MilestoneStatus @default(PENDING)
  
  scheduledDate DateTime?
  completedDate DateTime?
  
  // payment related
  paymentAmount Int?
  paymentStatus PaymentStatus @default(PENDING)
  
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  createdAt DateTime @default(now())
}


// // schema.prisma
// // Renowise platform - Prisma schema (map-first marketplace, messaging, bookings)

// generator client {
//   provider = "prisma-client-js"
// }

// datasource db {
//   provider = "postgresql"
//   url      = env("DATABASE_URL")
// }

// //////////////////////
// // Enums
// //////////////////////

// enum UserRole {
//   CUSTOMER
//   COMPANY
//   PUBLIC_ORGANIZATION
// }

// enum ListingType {
//   PROJECT
//   MATERIAL
//   SERVICE
// }

// enum BookingStatus {
//   PENDING
//   CONFIRMED
//   CANCELLED
//   COMPLETED
// }

// enum MessageSenderType {
//   USER
//   COMPANY
// }

// //////////////////////
// // Models
// //////////////////////

// model User {
//   id           String         @id @default(cuid())
//   email        String         @unique
//   password     String
//   name         String?
//   role         UserRole       @default(CUSTOMER)
//   createdAt    DateTime       @default(now())
//   updatedAt    DateTime       @updatedAt

//   // relations
//   companyProfile CompanyProfile?
//   listings       Listing[]          // Listings posted by this user (projects, materials)
//   messages       Message[]          @relation("UserMessages")
//   bookings       Booking[]          // Bookings where this user is the customer
//   refreshTokens  RefreshToken[]

//   @@map("users")
// }

// model CompanyProfile {
//   id          String    @id @default(cuid())
//   user        User      @relation(fields: [userId], references: [id])
//   userId      String    @unique

//   companyName String
//   description String?
//   logoUrl     String?
//   verified    Boolean   @default(false)

//   // Geo location for the company (optional)
//   latitude    Float?
//   longitude   Float?

//   // relations
//   services    Service[]
//   listings    Listing[]     // listings posted by company
//   messages    Message[]     @relation("CompanyMessages")
//   bookings    Booking[]     // bookings assigned to company

//   createdAt   DateTime @default(now())
//   updatedAt   DateTime @updatedAt

//   @@map("company_profiles")
// }

// model Service {
//   id          String          @id @default(cuid())
//   company     CompanyProfile  @relation(fields: [companyId], references: [id])
//   companyId   String

//   title       String
//   description String?
//   imageUrl    String?

//   createdAt   DateTime @default(now())

//   @@map("services")
// }

// model Listing {
//   id          String       @id @default(cuid())
//   type        ListingType

//   // Who posted it (either a user or a company)
//   user        User?        @relation(fields: [userId], references: [id])
//   userId      String?

//   company     CompanyProfile? @relation(fields: [companyId], references: [id])
//   companyId   String?

//   title       String
//   description String?
//   images      Json?        // array of image URLs / metadata

//   // Geo coordinates (required for map-first UX)
//   latitude    Float
//   longitude   Float

//   // Common marketplace fields
//   price       Int?         // price in smallest currency unit (e.g., cents)
//   quantity    String?      // e.g., "per roll", "per sqm" or simple text

//   // Project-specific fields
//   budgetMin   Int?
//   budgetMax   Int?
//   status      String?      // e.g., OPEN, ONGOING, COMPLETED

//   createdAt   DateTime     @default(now())
//   updatedAt   DateTime     @updatedAt

//   // Index to help geo queries (lat/lng)
//   @@index([latitude, longitude])
//   @@map("listings")
// }

// model Message {
//   id            String             @id @default(cuid())
//   text          String
//   createdAt     DateTime           @default(now())

//   senderType    MessageSenderType

//   // Optional sender/receiver relations depending on chat participants
//   user          User?              @relation("UserMessages", fields: [userId], references: [id])
//   userId        String?

//   company       CompanyProfile?    @relation("CompanyMessages", fields: [companyId], references: [id])
//   companyId     String?

//   // The message can be associated with a listing (optional)
//   listing       Listing?           @relation(fields: [listingId], references: [id])
//   listingId     String?

//   // Optionally add conversation/thread id later if you want grouped chats
//   threadId      String?             // string id to group messages into a thread

//   @@map("messages")
// }

// model Booking {
//   id          String         @id @default(cuid())
//   customer    User           @relation(fields: [customerId], references: [id])
//   customerId  String

//   company     CompanyProfile @relation(fields: [companyId], references: [id])
//   companyId   String

//   listing     Listing?       @relation(fields: [listingId], references: [id])
//   listingId   String?

//   visitDate   DateTime
//   status      BookingStatus  @default(PENDING)

//   notes       String?

//   createdAt   DateTime @default(now())
//   updatedAt   DateTime @updatedAt

//   @@map("bookings")
// }

// model RefreshToken {
//   id        String   @id @default(cuid())
//   token     String   @unique
//   user      User     @relation(fields: [userId], references: [id])
//   userId    String
//   createdAt DateTime @default(now())

//   @@map("refresh_tokens")
// }
